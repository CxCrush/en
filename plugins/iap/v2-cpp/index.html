<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>c++ - SDKBOX</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-62579154-2', 'sdkbox-doc.github.io/en');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">SDKBOX</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../installer/">Installer</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Plugins <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">IAP</a>
    <ul class="dropdown-menu">
        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Cocos2dx 3.x</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../v3-cpp/">c++</a>
</li>

        
            
<li >
    <a href="../v3-js/">js</a>
</li>

        
            
<li >
    <a href="../v3-lua/">lua</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Cocos2dx 2.x</a>
    <ul class="dropdown-menu">
        
            
<li class="active">
    <a href="./">c++</a>
</li>

        
            
<li >
    <a href="../v2-js/">js</a>
</li>

        
            
<li >
    <a href="../v2-lua/">lua</a>
</li>

        
    </ul>
  </li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../adcolony/">AdColony</a>
</li>

                        
                            
<li >
    <a href="../../chartboost/">Chartboost</a>
</li>

                        
                            
<li >
    <a href="../../vungle/">Vungle</a>
</li>

                        
                            
<li >
    <a href="../../googleanalytics/">Google Analytics</a>
</li>

                        
                            
<li >
    <a href="../../flurryanalytics/">Flurry Analytics</a>
</li>

                        
                            
<li >
    <a href="../../tune/">Tune</a>
</li>

                        
                            
<li >
    <a href="../../kochava/">Kochava</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../../release-note/">About</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../v3-lua/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../v2-js/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#overview">Overview</a></li>
        
    
        <li class="main "><a href="#integration">Integration</a></li>
        
    
        <li class="main "><a href="#extra-steps">Extra steps</a></li>
        
            <li><a href="#25-modify-yourgamenamejava">2.5 Modify &lt;YourGameName&gt;.java</a></li>
        
    
        <li class="main "><a href="#step-3-modify-your-game-code-to-invoke-in-app-purchase">Step 3: Modify your game code to invoke in-app purchase</a></li>
        
            <li><a href="#31-config-sdkbox_configjson">3.1 Config sdkbox_config.json</a></li>
        
            <li><a href="#32-initialize-iap">3.2 Initialize IAP</a></li>
        
            <li><a href="#33-retrieve-latest-product-data">3.3 Retrieve latest Product data</a></li>
        
            <li><a href="#34-make-a-purchase">3.4 Make a purchase</a></li>
        
            <li><a href="#35-restore-purchase">3.5 Restore purchase</a></li>
        
            <li><a href="#36-handling-purchase-events">3.6 Handling Purchase Events</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<!--
Include Base: /Users/niteluo/Projects/store/doc/en/src/iap/v3-cpp
-->

<h2 id="overview">Overview</h2>
<p>Provides you one stop solution for IAP integration across multiple platform, SDKBOX IAP offers easy to use yet powerful API, really simplify the tedious process of implementing IAPs in your game.</p>
<h2 id="integration">Integration</h2>
<p>Use the following command to install SDKBOX IAP plugin, Make sure you setup SDKBOX installer correctly.</p>
<pre><code class="bash">sdkbox import iap
</code></pre>

<h2 id="extra-steps">Extra steps</h2>
<h3 id="25-modify-yourgamenamejava">2.5 Modify <code>&lt;YourGameName&gt;.java</code></h3>
<ul>
<li>Modify <code>proj.android/src/&lt;package identifier&gt;/&lt;YourGameName&gt;.java</code> to add the following imports:</li>
</ul>
<pre><code class="java">import android.content.Intent;
import com.sdkbox.plugin.SDKBox;
</code></pre>

<ul>
<li>Second, modify the class to edit the <code>onCreate(final Bundle savedInstanceState)</code> function to add a call to <code>SDKBox.init(this);</code>. Example of what this might look like for you:</li>
</ul>
<pre><code class="java">protected void onCreate(Bundle savedInstanceState){
  super.onCreate(savedInstanceState);
  SDKBox.init(this);
}
</code></pre>

<ul>
<li>
<p>Last, we need to insert the proper <strong>overrides</strong> code. There are a few rules here.</p>
<ul>
<li>
<p>If the method listed has not been defined, <strong>add it</strong>.</p>
</li>
<li>
<p>If the method listed has been defined, add the calls to <code>SDKBox</code> in the <strong>same</strong> existing function.</p>
</li>
</ul>
</li>
</ul>
<pre><code class="java">    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
          if(!SDKBox.onActivityResult(requestCode, resultCode, data)) {
            super.onActivityResult(requestCode, resultCode, data);
          }
    }
    @Override
    protected void onStart() {
          super.onStart();
          SDKBox.onStart();
    }
    @Override
    protected void onStop() {
          super.onStop();
          SDKBox.onStop();
    }
    @Override
    protected void onResume() {
          super.onResume();
          SDKBox.onResume();
    }
    @Override
    protected void onPause() {
          super.onPause();
          SDKBox.onPause();
    }
    @Override
    public void onBackPressed() {
          if(!SDKBox.onBackPressed()) {
            super.onBackPressed();
          }
    }
</code></pre>

<h2 id="step-3-modify-your-game-code-to-invoke-in-app-purchase">Step 3: Modify your game code to invoke in-app purchase</h2>
<h3 id="31-config-sdkbox_configjson">3.1 Config <code>sdkbox_config.json</code></h3>
<ul>
<li>
<p>First time <code>SDKBOX</code> user:</p>
<ul>
<li>Rename the included <code>sdkbox_config.json.sample</code> to <code>sdkbox_config.json</code></li>
<li>Copy <code>sdkbox_config.json</code> to the <strong>Resources</strong> directory of your project  </li>
<li>Then Drag &amp; drop <code>sdkbox_config.json</code> from your <strong>Resources</strong> folder to Xcode’s Resources folder this will make sure <code>sdkbox_config.json</code> is in your bundle</li>
</ul>
</li>
<li>
<p>If you already have an <code>sdkbox_config.json</code> file in your project:</p>
<ul>
<li>Insert the <strong>iap</strong> section of <code>sdkbox_config.json.sample</code> into your
  existing <code>sdkbox_config.json</code> and change the config as you see fit</li>
</ul>
</li>
</ul>
<h3 id="32-initialize-iap">3.2 Initialize IAP</h3>
<ul>
<li>Call <code>sdkbox::IAP::init();</code> where appropriate in your code. We
recommend to do this in the <code>AppDelegate::applicationDidFinishLaunching()</code> or <code>AppController:didFinishLaunchingWithOptions()</code>. Make sure to include the appropriate headers:</li>
</ul>
<pre><code class="cpp">#include &quot;PluginIAP/PluginIAP.h&quot;
</code></pre>

<h3 id="33-retrieve-latest-product-data">3.3 Retrieve latest Product data</h3>
<p>It's always a good idea to retrieve the latest product data from store when your game starts.</p>
<p>To retrieve latest IAP data, simply call <code>sdkbox::IAP::refresh()</code>.</p>
<blockquote>
<p><code>onProductRequestSuccess</code> if retrieved successfully.</p>
<p><code>onProductRequestFailure</code> if exception occurs.</p>
</blockquote>
<h3 id="34-make-a-purchase">3.4 Make a purchase</h3>
<p>To make a purchase call <code>sdkbox::IAP::purchase(name)</code></p>
<p><strong>Note:</strong> <strong>name</strong> is the name of the IAP item in your config file under <code>items</code> tag, not the product id you set in iTunes or GooglePlay Store</p>
<blockquote>
<p><code>onSuccess</code> will be triggered if purchase is successful.</p>
<p><code>onFailure</code> will be triggered if purchase fails.</p>
<p><code>onCanceled</code> will be triggered if purchase is canceled by user.</p>
</blockquote>
<h3 id="35-restore-purchase">3.5 Restore purchase</h3>
<p>To restore purchase call <code>sdkbox::IAP::restore()</code>.</p>
<blockquote>
<p><code>onRestored</code> will be triggered if restore is successful.</p>
</blockquote>
<p><strong>Note:</strong> <code>onRestored</code> could be triggered multiple times</p>
<h3 id="36-handling-purchase-events">3.6 Handling Purchase Events</h3>
<p>This allows you to catch the <code>IAP</code> events so that you can perform operations based upon the response from your players and IAP servers.</p>
<ul>
<li>Allow your class to extend <code>sdkbox::IAPListener</code>:</li>
</ul>
<pre><code class="cpp">    #include &quot;PluginIAP/PluginIAP.h&quot;
    class MyClass : public sdkbox::IAPListener
    {
    private:
        virtual void onSuccess(sdkbox::Product const&amp; p) override;
        virtual void onFailure(sdkbox::Product const&amp; p, const std::string &amp;msg)
           override;
        virtual void onCanceled(sdkbox::Product const&amp; p) override;
        virtual void onRestored(sdkbox::Product const&amp; p) override;
        virtual void onProductRequestSuccess(std::vector&lt;sdkbox::Product&gt; const &amp;products)
        override;
        virtual void onProductRequestFailure(const std::string &amp;msg) override;
    }
</code></pre>

<ul>
<li>Create a <strong>listener</strong> that handles callbacks:</li>
</ul>
<pre><code class="cpp">sdkbox::IAP::setListener(listener);
</code></pre></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
